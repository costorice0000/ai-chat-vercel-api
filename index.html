<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„å€‹äººç©ºé–“</title>
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        :root {
            --primary-purple: #6A0DAD; 
            --light-purple: #F3E5FF;    
            --chat-bg: #ffffff;
        }

        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            background-color: var(--light-purple); 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh;
        }
        
        /* ä¸­å¤®å€‹äººä¸»é å®¹å™¨ */
        .container { 
            background: rgba(255, 255, 255, 0.9); 
            padding: 50px 30px; 
            border-radius: 25px; 
            max-width: 450px; 
            width: 90%;
            text-align: center;
            box-shadow: 0 15px 35px rgba(106, 13, 173, 0.15); 
            backdrop-filter: blur(10px);
        }

        .profile-image { 
            width: 130px; 
            height: 130px; 
            border-radius: 50%; 
            border: 5px solid var(--primary-purple); 
            margin-bottom: 20px; 
            object-fit: cover;
        }

        h1 { color: var(--primary-purple); font-size: 2.2rem; margin: 0; }
        p { color: #555; margin: 10px 0 30px 0; line-height: 1.6; }

        .link-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .custom-link {
            display: block;
            background-color: white;
            color: var(--primary-purple);
            text-decoration: none;
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            border: 2px solid var(--primary-purple);
            transition: all 0.3s ease;
        }

        .custom-link:hover {
            background-color: var(--primary-purple);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(106, 13, 173, 0.3);
        }

        /* æ‡¸æµ® AI æŒ‰éˆ• */
        #chat-widget-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background-color: var(--primary-purple);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            font-size: 28px;
            z-index: 1000;
        }

        /* èŠå¤©æ–¹æ¡† */
        .chat-box { 
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 380px;
            max-width: 90vw;
            height: 550px;
            max-height: 70vh;
            background: var(--chat-bg); 
            border-radius: 20px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.2); 
            display: none; 
            flex-direction: column; 
            overflow: hidden;
            border: 1px solid #eee;
            z-index: 1000;
            text-align: left;
        }

        .chat-header { background: var(--primary-purple); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; }
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; background: #fafafa; }
        .msg { max-width: 85%; padding: 12px; border-radius: 15px; font-size: 14px; line-height: 1.5; }
        .user-msg { align-self: flex-end; background: #e0c3ff; color: #300050; border-bottom-right-radius: 4px; }
        .bot-msg { align-self: flex-start; background: white; border: 1px solid #eee; border-bottom-left-radius: 4px; }
        
        .input-area { padding: 12px; display: flex; gap: 8px; border-top: 1px solid #eee; background: white; }
        #question { flex: 1; height: 45px; resize: none; border-radius: 10px; border: 1px solid #ddd; padding: 8px; font-size: 14px; }
        #send-btn { background: var(--primary-purple); color: white; border: none; padding: 0 18px; border-radius: 10px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <img src="https://i.pinimg.com/736x/62/c1/31/62c131d2578f93d698e9eed5c8ea4eda.jpg" class="profile-image">
        <h1>âœ¨ Castorice</h1>
        <p>æˆ‘çš„å€‹äººç©ºé–“âœ¨âœ¨</p>

        <div class="link-group">
            <a href="https://github.com" target="_blank" class="custom-link">ç©ºæ ¼</a>
            <a href="https://www.google.com" target="_blank" class="custom-link">ğŸŒ å¸¸ç”¨è³‡æºå°èˆª</a>
        </div>
    </div>

    <div id="chat-widget-button" onclick="toggleChat()">ğŸ’¬</div>

    <div id="chat-box" class="chat-box">
        <div class="chat-header">
            <span>å°å°è¶</span>
            <span style="cursor:pointer" onclick="toggleChat()">âœ–</span>
        </div>
        <div id="chat-window">
            <div class="msg bot-msg">é–£ä¸‹ï¼Œéœ€è¦å”åŠ©å—ï¼Ÿâœ¨</div>
        </div>
        <form id="chat-form" class="input-area">
            <textarea id="question" placeholder="è¼¸å…¥è¨Šæ¯..."></textarea>
            <button id="send-btn" type="submit">ç™¼é€</button>
        </form>
    </div>

<script>
    function toggleChat() {
        const box = document.getElementById("chat-box");
        box.style.display = (box.style.display === "flex") ? "none" : "flex";
    }

    let conversation = [];
    const chatWindow = document.getElementById("chat-window");

    document.getElementById("chat-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const text = document.getElementById("question").value.trim();
        if (!text) return;

        // é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
        const userDiv = document.createElement("div");
        userDiv.className = "msg user-msg";
        userDiv.innerText = text;
        chatWindow.appendChild(userDiv);
        
        document.getElementById("question").value = "";
        chatWindow.scrollTop = chatWindow.scrollHeight;

        const thinking = document.createElement("div");
        thinking.className = "msg bot-msg";
        thinking.style.color = "#999";
        thinking.innerText = "æ­£åœ¨æ€è€ƒä¸­...";
        chatWindow.appendChild(thinking);

        try {
            // ğŸ’¡ æ”¹ç‚ºå‘¼å« Vercel å¾Œç«¯ï¼Œä¸å†éœ€è¦ API Key å‡ºç¾åœ¨ä»£ç¢¼è£¡
            const res = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: "gemini-2.0-flash-exp", // è¨­å®šç‚º Gemini 2.0
                    contents: [...conversation, { role: "user", parts: [{ text }] }]
                })
            });

            const data = await res.json();
            thinking.remove();

            if (data.error) {
                const errDiv = document.createElement("div");
                errDiv.className = "msg bot-msg";
                errDiv.innerText = "âš ï¸ éŒ¯èª¤ï¼š" + data.error.message;
                chatWindow.appendChild(errDiv);
            } else {
                const reply = data.candidates[0].content.parts[0].text;
                const botDiv = document.createElement("div");
                botDiv.className = "msg bot-msg";
                botDiv.innerHTML = marked.parse(reply); // ä½¿ç”¨ marked è§£æ Markdown
                chatWindow.appendChild(botDiv);
                
                conversation.push({ role: "user", parts: [{ text }] });
                conversation.push({ role: "model", parts: [{ text: reply }] });
            }
        } catch (err) {
            thinking.innerText = "âŒ ç„¡æ³•é€£æ¥æœå‹™ï¼Œè«‹ç¢ºèª Vercel è¨­å®šã€‚";
        }
        chatWindow.scrollTop = chatWindow.scrollHeight;
    });
</script>
</body>
</html>

