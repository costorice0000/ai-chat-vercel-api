<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Castorice çš„ç©ºé–“</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script>
    <style>
        :root { --primary-purple: #6A0DAD; --light-purple: #F3E5FF; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: var(--light-purple); display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { background: rgba(255, 255, 255, 0.9); padding: 50px 30px; border-radius: 25px; max-width: 450px; width: 90%; text-align: center; box-shadow: 0 15px 35px rgba(106, 13, 173, 0.15); }
        .profile-image { width: 130px; height: 130px; border-radius: 50%; border: 5px solid var(--primary-purple); margin-bottom: 20px; object-fit: cover; }
        h1 { color: var(--primary-purple); margin: 0; }
        .link-group { display: flex; flex-direction: column; gap: 15px; margin-top: 25px; }
        .custom-link { display: block; background: white; color: var(--primary-purple); text-decoration: none; padding: 15px; border-radius: 12px; font-weight: bold; border: 2px solid var(--primary-purple); transition: 0.3s; }
        .custom-link:hover { background: var(--primary-purple); color: white; transform: translateY(-3px); }
        
        /* æ‡¸æµ® AI æŒ‰éˆ• */
        #chat-widget-button { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--primary-purple); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; box-shadow: 0 8px 20px rgba(0,0,0,0.2); font-size: 28px; z-index: 1000; }
        .chat-box { position: fixed; bottom: 100px; right: 30px; width: 380px; max-width: 90vw; height: 500px; background: white; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.2); display: none; flex-direction: column; overflow: hidden; border: 1px solid #eee; z-index: 1000; text-align: left; }
        .chat-header { background: var(--primary-purple); color: white; padding: 15px; font-weight: bold; display: flex; justify-content: space-between; }
        #chat-window { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; background: #fafafa; }
        .msg { max-width: 85%; padding: 12px; border-radius: 15px; font-size: 14px; }
        .user-msg { align-self: flex-end; background: #e0c3ff; color: #300050; }
        .bot-msg { align-self: flex-start; background: white; border: 1px solid #eee; }
        .input-area { padding: 12px; display: flex; gap: 8px; border-top: 1px solid #eee; background: white; }
        #question { flex: 1; height: 45px; resize: none; border-radius: 10px; border: 1px solid #ddd; padding: 8px; }
        #send-btn { background: var(--primary-purple); color: white; border: none; padding: 0 18px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        .model-select { padding: 10px; background: #f0f0f0; font-size: 12px; border-bottom: 1px solid #ddd; }
    </style>
</head>
<body>

    <div class="container">
        <img src="https://i.pinimg.com/736x/62/c1/31/62c131d2578f93d698e9eed5c8ea4eda.jpg" class="profile-image">
        <h1>âœ¨ Castorice</h1>
        <div class="link-group">
            <a href="https://github.com" target="_blank" class="custom-link">ğŸ“‚ æˆ‘çš„å°ˆæ¡ˆä½œå“é›† (GitHub)</a>
            <a href="https://www.google.com" target="_blank" class="custom-link">ğŸŒ å¸¸ç”¨è³‡æºå°èˆª</a>
        </div>
    </div>

    <div id="chat-widget-button" onclick="toggleChat()">ğŸ’¬</div>

    <div id="chat-box" class="chat-box">
        <div class="chat-header"><span>å…§å»º AI åŠ©æ‰‹</span><span style="cursor:pointer" onclick="toggleChat()">âœ–</span></div>
        <div class="model-select">
            ğŸ¤– é©…å‹•æ¨¡å‹ï¼š
            <select id="model">
                <option value="gemini-2.0-flash-exp">Gemini 2.0 Flash</option>
                <option value="gemini-1.5-flash" selected>Gemini 1.5 Flash</option>
            </select>
        </div>
        <div id="chat-window"></div>
        <form id="form" class="input-area">
            <textarea id="question" placeholder="è¼¸å…¥è¨Šæ¯..."></textarea>
            <button id="send-btn" type="submit">ç™¼é€</button>
        </form>
    </div>

<script>
    function toggleChat() {
        const box = document.getElementById("chat-box");
        box.style.display = (box.style.display === "flex") ? "none" : "flex";
    }

    let conversation = [];
    const chatWindow = document.getElementById("chat-window");

    function addMsg(content, type) {
        const div = document.createElement("div");
        div.className = "msg " + type;
        div.innerHTML = content;
        chatWindow.appendChild(div);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        return div;
    }

    document.getElementById("form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const text = document.getElementById("question").value.trim();
        if (!text) return;

        addMsg(text, "user-msg");
        document.getElementById("question").value = "";
        const thinking = addMsg("AI æ­£åœ¨æ€è€ƒ...", "bot-msg");

        try {
            // ğŸ’¡ é—œéµæ”¹å‹•ï¼šå‘¼å«ä½ è‡ªå·±çš„ Vercel API
            const res = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    model: document.getElementById("model").value,
                    contents: [...conversation, { role: "user", parts: [{ text }] }]
                })
            });

            const data = await res.json();
            thinking.remove();
            const reply = data.candidates[0].content.parts[0].text;
            addMsg(marked.parse(reply), "bot-msg");
            conversation.push({ role: "user", parts: [{ text }] }, { role: "model", parts: [{ text: reply }] });
        } catch (err) {
            thinking.innerText = "âŒ æœå‹™ç›®å‰ä¸å¯ç”¨ï¼Œè«‹ç¢ºèª Vercel ç’°å¢ƒè®Šæ•¸ã€‚";
        }
    });
</script>
</body>
</html>
